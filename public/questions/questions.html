<!doctype html>
<html lang="hr">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Jednostavan Kviz - Konstruktor</title>
    <link href="../questions/css/questions.css" rel="stylesheet" />
</head>

<body>
    <div class="card" id="app">
        <h1>Quiz Beginner</h1>
        <div class="card-content">
            <div class="image-container">
                <img id="question-image" src="" alt="Slika pitanja" />
            </div>
            <div class="quiz-content" id="quiz-root">
            </div>
        </div>
    </div>

    <script>
        class Quiz {
            constructor(container, questions = [], opts = {}) {
                this.container = container;
                this.questions = questions;
                this.index = 0;
                this.score = 0;
                this.userAnswers = new Array(questions.length).fill(null);
                this.showCorrectOnSubmit = opts.showCorrectOnSubmit ?? true;
                this.render();
            }

            render() {
                this.container.innerHTML = `
          <div class="meta-block">
            <div class="progress" id="progress"></div>
            <div class="timer" id="timer">00:30</div>
            <div class="points" id="points">Score: 0</div>
            <div class="question-block">
              <div class="question" id="question"></div>
            </div>
          </div>
          <div class="answers" id="answers"></div>
          <div class="controls">
            <div>
              <button id="prevBtn" class="secondary">Previous</button>
              <button id="nextBtn">Next</button>
            </div>
            <div class="progress" id="scoreDisplay"></div>
          </div>
          <div id="resultArea"></div>
        `;

                this.$question = this.container.querySelector('#question');
                this.$answers = this.container.querySelector('#answers');
                this.$progress = this.container.querySelector('#progress');
                this.$scoreDisplay = this.container.querySelector('#scoreDisplay');
                this.$prevBtn = this.container.querySelector('#prevBtn');
                this.$nextBtn = this.container.querySelector('#nextBtn');
                this.$resultArea = this.container.querySelector('#resultArea');
                this.timerDuration = 30;
                this.timer = null;
                this.timerElement = this.container.querySelector('#timer');
                this.$points = this.container.querySelector('#points');

                this.$prevBtn.addEventListener('click', () => this.prev());
                this.$nextBtn.addEventListener('click', () => this.next());

                window.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowRight') this.next();
                    if (e.key === 'ArrowLeft') this.prev();
                });

                this.showQuestion();
            }

            startTimer() {
                clearInterval(this.timer);
                let timeLeft = this.timerDuration;
                this.updateTimerDisplay(timeLeft);

                this.timer = setInterval(() => {
                    timeLeft--;
                    this.updateTimerDisplay(timeLeft);

                    if (timeLeft <= 0) {
                        clearInterval(this.timer);
                        this.next();
                    }
                }, 1000);
            }

            updateTimerDisplay(seconds) {
                const mins = String(Math.floor(seconds / 60)).padStart(2, '0');
                const secs = String(seconds % 60).padStart(2, '0');
                this.timerElement.textContent = `${mins}:${secs}`;
            }

            showQuestion() {
                const q = this.questions[this.index];
                this.$question.textContent = `${this.index + 1}. ${q.text}`;
                this.$answers.innerHTML = '';
                q.choices.forEach((c, i) => {
                    const div = document.createElement('div');
                    div.className = 'answer';
                    div.tabIndex = 0;
                    div.textContent = c;
                    div.addEventListener('click', () => this.select(i));
                    div.addEventListener('keydown', (e) => { if (e.key === 'Enter') this.select(i) });

                    if (this.userAnswers[this.index] === i) div.classList.add('selected');

                    this.$answers.appendChild(div);
                });

                const imgEl = document.getElementById('question-image');
                if (q.image) {
                    imgEl.src = q.image;
                    imgEl.style.display = 'block';
                } else {
                    imgEl.src = '';
                    imgEl.style.display = 'none';
                }

                this.updateMeta();
                this.updateButtons();
                this.$resultArea.innerHTML = '';
                this.startTimer();
            }

            select(choiceIndex) {
                this.userAnswers[this.index] = choiceIndex;
                Array.from(this.$answers.children).forEach((el, i) => {
                    el.classList.toggle('selected', i === choiceIndex);
                });

                this.calculateScore();
            }

            calculateScore() {
                let correct = 0;
                this.questions.forEach((q, i) => {
                    if (this.userAnswers[i] === q.answerIndex) correct++;
                });
                this.score = correct;
                this.$points.textContent = `Score: ${this.score}`;
            }

            next() {
                if (this.index < this.questions.length - 1) {
                    this.index++;
                    this.showQuestion();
                } else {
                    this.finish();
                }
            }

            prev() {
                if (this.index > 0) {
                    this.index--;
                    this.showQuestion();
                }
            }

            updateMeta() {
                this.$progress.textContent = `Question ${this.index + 1} of ${this.questions.length}`;
                this.$scoreDisplay.textContent = `Answered: ${this.userAnswers.filter(a => a !== null).length}/${this.questions.length}`;
                this.$points.textContent = `Score: ${this.score}`;
            }

            updateButtons() {
                this.$prevBtn.disabled = this.index === 0;
                this.$nextBtn.textContent = (this.index === this.questions.length - 1) ? 'Finish' : 'Next';
            }

            finish() {
                this.calculateScore();
                this.$resultArea.innerHTML = `<div class="result">Score: ${this.score} / ${this.questions.length}</div>`;
                this.timerElement.textContent = '00:00';
            }
        }

        const sampleQuestions = [
            {
                id: 1,
                text: 'In which country is Zwolle located?',
                choices: ['Germany', 'Belgium', 'Netherlands', 'France'],
                answerIndex: 2,
                image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Map_Netherlands_Zwolle.png/320px-Map_Netherlands_Zwolle.png'
            },
            {
                id: 2,
                text: 'In which country is Split located?',
                choices: ['Italy', 'Croatia', 'Slovenia', 'Greece'],
                answerIndex: 1,
                image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a1/Split_%28Orthophoto%29.png/320px-Split_%28Orthophoto%29.png'
            },
            {
                id: 3,
                text: 'Which sport is most popular in Zwolle?',
                choices: ['Football', 'Basketball', 'Ice hockey', 'Rugby'],
                answerIndex: 0,
                image: ''
            }
        ];

        const root = document.getElementById('quiz-root');
        new Quiz(root, sampleQuestions, { showCorrectOnSubmit: true });
    </script>
</body>

</html>