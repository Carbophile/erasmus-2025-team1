<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<title>User Results</title>
	<link rel="stylesheet" href="styleQuizCrud.css" />
	<link
		rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
	/>
	<style>
		.icon-btn.danger {
			background: #dc3545;
			color: #fff;
			border: none;
			padding: 6px 10px;
			border-radius: 6px;
			cursor: pointer;
		}
		.table-header h2 span {
			color: #555;
			font-weight: normal;
			font-size: 0.9em;
			margin-left: 8px;
		}

		/* Delete overlay */
		.overlay {
			position: fixed;
			top: 0; left: 0;
			width: 100%; height: 100%;
			background: rgba(0,0,0,0.5);
			display: none;
			justify-content: center;
			align-items: center;
		}
		.overlay-content {
			background: #fff;
			padding: 20px;
			border-radius: 12px;
			width: 320px;
			text-align: center;
			box-shadow: 0 2px 12px rgba(0,0,0,0.2);
		}
		.overlay-content h3 {
			margin-bottom: 12px;
			color: #333;
		}
		.overlay-content p {
			margin-bottom: 20px;
			color: #555;
		}
		.confirm-btn, .close-btn {
			display: block;
			margin-top: 10px;
			padding: 10px;
			width: 100%;
			border: none;
			border-radius: 8px;
			font-size: 14px;
			cursor: pointer;
			transition: background 0.2s;
		}
		.confirm-btn {
			background: #dc3545;
			color: #fff;
		}
		.confirm-btn:hover {
			background: #c82333;
		}
		.close-btn {
			background: #6c757d;
			color: #fff;
		}
		.close-btn:hover {
			background: #5a6268;
		}
	</style>
</head>
<body>
	<aside class="sidebar">
		<div class="logo">QuizBattle</div>
		<nav>
			<a href="/admin/users" class="active"><i class="fa-solid fa-users"></i><span>Users</span></a>
			<a href="/admin/questions"><i class="fa-solid fa-question"></i><span>Questions</span></a>
		</nav>
	</aside>

	<div class="main">
		<header class="topbar">
			<div class="nav-left">
				<button class="btn" onclick="window.location.href='index.html'">Home</button>
				<button class="btn">Leaderboard</button>
			</div>
			<div class="search-box">
					<input type="text" placeholder="Search..." />
					<i class="fa fa-search"></i>
				</div>
			<div class="nav-right">
				<i class="fa-solid fa-user user-icon"></i>
			</div>
		</header>

		<section class="table-section">
			<div class="table-header">
				<h2 id="results-title">User Results</h2>
			</div>

			<div class="table-container">
				<table>
					<thead>
						<tr>
							<th>Result Id</th>
							<th>Score</th>
							<th>Time Taken</th>
							<th>Quiz Id</th>
							<th>Date</th>
							<th>Delete</th>
						</tr>
					</thead>
					<tbody id="results-table-body">
						<!-- Filled dynamically -->
					</tbody>
				</table>
			</div>
		</section>
	</div>

	<!-- ✅ Delete confirmation overlay -->
	<div class="overlay" id="delete-overlay">
		<div class="overlay-content">
			<h3>Delete Result</h3>
			<p>Are you sure you want to delete this result?</p>
			<button class="confirm-btn" id="confirm-delete">Delete</button>
			<button class="close-btn" onclick="closeDeleteOverlay()">Cancel</button>
		</div>
	</div>

	<script>
		const users = {
			1: { id: 1, name: "Alice Johnson" },
			2: { id: 2, name: "Bob Smith" },
			3: { id: 3, name: "Charlie Lee" },
			4: { id: 4, name: "Diana Prince" }
		};

		const allResults = {
			1: [
				{ id: 101, score: 85, time: "02:30", quizId: 1, date: "2025-09-20" },
				{ id: 102, score: 92, time: "01:50", quizId: 2, date: "2025-09-21" }
			],
			2: [
				{ id: 201, score: 76, time: "03:10", quizId: 1, date: "2025-09-19" }
			],
			3: [
				{ id: 301, score: 65, time: "04:05", quizId: 3, date: "2025-09-22" }
			],
			4: []
		};

		const params = new URLSearchParams(window.location.search);
		const userId = params.get("id");

		const resultsTable = document.getElementById("results-table-body");
		const resultsTitle = document.getElementById("results-title");

		if (userId && users[userId]) {
			resultsTitle.textContent = `Results for ${users[userId].name}`;
		}

		// Render results
		if (userId && allResults[userId] && allResults[userId].length > 0) {
			allResults[userId].forEach(res => {
				const row = document.createElement("tr");
				row.innerHTML = `
					<td>${res.id}</td>
					<td>${res.score}</td>
					<td>${res.time}</td>
					<td>${res.quizId}</td>
					<td>${res.date}</td>
					<td><button class="icon-btn danger" onclick="openDeleteOverlay(${userId}, ${res.id}, this)"><i class="fa fa-trash"></i></button></td>
				`;
				resultsTable.appendChild(row);
			});
		} else {
			resultsTable.innerHTML = `<tr><td colspan="6" style="text-align:center; color:#888;">No results found for this user.</td></tr>`;
		}

		// ✅ Delete overlay logic
		let deleteTarget = null; // will store {userId, resultId, row}
		function openDeleteOverlay(userId, resultId, btn) {
			deleteTarget = { userId, resultId, row: btn.closest("tr") };
			document.getElementById("delete-overlay").style.display = "flex";
		}
		function closeDeleteOverlay() {
			deleteTarget = null;
			document.getElementById("delete-overlay").style.display = "none";
		}
		document.getElementById("confirm-delete").onclick = function() {
			if (!deleteTarget) return;

			const { userId, resultId, row } = deleteTarget;
			allResults[userId] = allResults[userId].filter(r => r.id !== resultId);
			row.remove();

			if (allResults[userId].length === 0) {
				resultsTable.innerHTML = `<tr><td colspan="6" style="text-align:center; color:#888;">No results left for this user.</td></tr>`;
			}

			closeDeleteOverlay();
		};
	</script>
</body>
</html>
